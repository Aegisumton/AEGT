{"ast":null,"code":"import React,{useState}from'react';import{motion}from'framer-motion';import{Zap,TrendingUp,Battery,Cpu,Wallet,CheckCircle,AlertCircle,Coins,ArrowUp,Clock,Star,Gift}from'lucide-react';import{toast}from'react-hot-toast';import{useQuery,useMutation,useQueryClient}from'react-query';import{upgradeAPI,energyAPI}from'../services/api';import{useTonConnect}from'../hooks/useTonConnect';import{useTelegramWebApp}from'../hooks/useTelegramWebApp';import{useAuth}from'../hooks/useAuth';import TonPayment from'../components/TonPayment';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const UpgradeShop=()=>{const[selectedUpgrade,setSelectedUpgrade]=useState(null);const[showPayment,setShowPayment]=useState(false);const[paymentType,setPaymentType]=useState('aegt');// 'aegt' or 'ton'\nconst{tonConnectUI,wallet}=useTonConnect();const{hapticFeedback}=useTelegramWebApp();const{user}=useAuth();const queryClient=useQueryClient();// Fetch energy status\nconst{data:energyStatus}=useQuery('energyStatus',energyAPI.getStatus,{refetchInterval:5000,select:response=>response.data});// Energy restore mutation\nconst restoreEnergyMutation=useMutation(energyAPI.refill,{onSuccess:()=>{hapticFeedback('notification','success');toast.success('Energy restored!');queryClient.invalidateQueries('energyStatus');},onError:error=>{var _error$response,_error$response$data;hapticFeedback('notification','error');toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Energy restore failed');}});// Purchase upgrade mutation\nconst purchaseUpgradeMutation=useMutation(upgradeAPI.purchase,{onSuccess:response=>{hapticFeedback('notification','success');toast.success(response.message);queryClient.invalidateQueries('miningStatus');queryClient.invalidateQueries('energyStatus');setShowPayment(false);setSelectedUpgrade(null);},onError:error=>{var _error$response2,_error$response2$data;hapticFeedback('notification','error');toast.error(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Purchase failed');}});// Predefined upgrades\nconst upgrades=[{id:'miner_level_2',name:'Miner Level 2',description:'Increase mining speed by 50%',icon:'cpu',costAEGT:5000000000,// 5 AEGT\ncostTON:0.5,// 0.5 TON\nbenefits:['+50% Mining Speed','+25% Energy Efficiency'],currentLevel:(user===null||user===void 0?void 0:user.minerLevel)||1,maxLevel:10,available:((user===null||user===void 0?void 0:user.minerLevel)||1)<2},{id:'energy_capacity_2',name:'Energy Capacity Level 2',description:'Increase energy capacity by 500',icon:'battery',costAEGT:3000000000,// 3 AEGT\ncostTON:0.3,// 0.3 TON\nbenefits:['+500 Energy Capacity','+20% Energy Regen'],currentLevel:(user===null||user===void 0?void 0:user.energyLevel)||1,maxLevel:10,available:((user===null||user===void 0?void 0:user.energyLevel)||1)<2},{id:'hashrate_boost',name:'Hashrate Booster',description:'Permanent +100 hashrate boost',icon:'zap',costAEGT:2000000000,// 2 AEGT\ncostTON:0.2,// 0.2 TON\nbenefits:['+100 Hashrate','+10% Block Rewards'],currentLevel:0,maxLevel:5,available:true}];const getUpgradeIcon=iconType=>{switch(iconType){case'cpu':return/*#__PURE__*/_jsx(Cpu,{size:24});case'battery':return/*#__PURE__*/_jsx(Battery,{size:24});case'zap':return/*#__PURE__*/_jsx(Zap,{size:24});default:return/*#__PURE__*/_jsx(TrendingUp,{size:24});}};const handleUpgradeClick=(upgrade,type)=>{setSelectedUpgrade(upgrade);setPaymentType(type);setShowPayment(true);};const handleAEGTUpgrade=async upgrade=>{try{await purchaseUpgradeMutation.mutateAsync({upgradeId:upgrade.id,paymentType:'aegt',amount:upgrade.costAEGT});}catch(error){console.error('AEGT upgrade error:',error);}};const handleTONUpgrade=async transactionHash=>{try{await purchaseUpgradeMutation.mutateAsync({upgradeId:selectedUpgrade.id,paymentType:'ton',amount:selectedUpgrade.costTON,transactionHash});}catch(error){console.error('TON upgrade error:',error);}};const handleEnergyRestore=()=>{hapticFeedback('impact','medium');restoreEnergyMutation.mutate();};const formatAEGT=amount=>{return(amount/1000000000).toFixed(1);};return/*#__PURE__*/_jsxs(\"div\",{className:\"upgrade-shop\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"shop-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDED2 Upgrade Shop\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Enhance your mining capabilities\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-stats\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(Coins,{size:20}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"AEGT Balance\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[formatAEGT((user===null||user===void 0?void 0:user.aegtBalance)||0),\" AEGT\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(Cpu,{size:20}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Miner Level\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[\"Level \",(user===null||user===void 0?void 0:user.minerLevel)||1]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(Battery,{size:20}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Energy\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-value\",children:[(energyStatus===null||energyStatus===void 0?void 0:energyStatus.current)||0,\"/\",(energyStatus===null||energyStatus===void 0?void 0:energyStatus.max)||1000]})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"energy-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u26A1 Energy Management\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"energy-restore-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"energy-info\",children:[/*#__PURE__*/_jsx(Battery,{size:24}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Restore Energy\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Instantly restore all energy\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"energy-actions\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"restore-btn aegt\",onClick:handleEnergyRestore,disabled:restoreEnergyMutation.isLoading||(energyStatus===null||energyStatus===void 0?void 0:energyStatus.current)>=(energyStatus===null||energyStatus===void 0?void 0:energyStatus.max),children:[/*#__PURE__*/_jsx(Coins,{size:16}),\"1.0 AEGT\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"restore-btn ton\",onClick:()=>handleUpgradeClick({id:'energy_restore',name:'Energy Restore',costTON:0.1},'ton'),disabled:(energyStatus===null||energyStatus===void 0?void 0:energyStatus.current)>=(energyStatus===null||energyStatus===void 0?void 0:energyStatus.max),children:[/*#__PURE__*/_jsx(Wallet,{size:16}),\"0.1 TON\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"upgrades-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDE80 Upgrades\"}),/*#__PURE__*/_jsx(\"div\",{className:\"upgrades-grid\",children:upgrades.map(upgrade=>/*#__PURE__*/_jsxs(motion.div,{className:\"upgrade-card \".concat(!upgrade.available?'disabled':''),whileHover:{scale:upgrade.available?1.02:1},whileTap:{scale:upgrade.available?0.98:1},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"upgrade-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"upgrade-icon\",children:getUpgradeIcon(upgrade.icon)}),/*#__PURE__*/_jsxs(\"div\",{className:\"upgrade-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:upgrade.name}),/*#__PURE__*/_jsx(\"p\",{children:upgrade.description})]}),!upgrade.available&&/*#__PURE__*/_jsxs(\"div\",{className:\"upgrade-status\",children:[/*#__PURE__*/_jsx(CheckCircle,{size:20}),/*#__PURE__*/_jsx(\"span\",{children:\"Owned\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"upgrade-benefits\",children:upgrade.benefits.map((benefit,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"benefit-item\",children:[/*#__PURE__*/_jsx(Star,{size:14}),/*#__PURE__*/_jsx(\"span\",{children:benefit})]},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"upgrade-level\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Level \",upgrade.currentLevel,\"/\",upgrade.maxLevel]}),/*#__PURE__*/_jsx(\"div\",{className:\"level-bar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"level-progress\",style:{width:\"\".concat(upgrade.currentLevel/upgrade.maxLevel*100,\"%\")}})})]}),upgrade.available&&/*#__PURE__*/_jsxs(\"div\",{className:\"upgrade-actions\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"upgrade-btn aegt\",onClick:()=>handleAEGTUpgrade(upgrade),disabled:purchaseUpgradeMutation.isLoading||((user===null||user===void 0?void 0:user.aegtBalance)||0)<upgrade.costAEGT,children:[/*#__PURE__*/_jsx(Coins,{size:16}),formatAEGT(upgrade.costAEGT),\" AEGT\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"upgrade-btn ton\",onClick:()=>handleUpgradeClick(upgrade,'ton'),disabled:purchaseUpgradeMutation.isLoading,children:[/*#__PURE__*/_jsx(Wallet,{size:16}),upgrade.costTON,\" TON\"]})]})]},upgrade.id))})]}),showPayment&&selectedUpgrade&&paymentType==='ton'&&/*#__PURE__*/_jsx(TonPayment,{amount:selectedUpgrade.costTON,description:\"Purchase \".concat(selectedUpgrade.name),onSuccess:handleTONUpgrade,onCancel:()=>{setShowPayment(false);setSelectedUpgrade(null);}})]});};export default UpgradeShop;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}