{"ast":null,"code":"import React,{useState,useEffect}from'react';import{motion,AnimatePresence}from'framer-motion';import{Play,Pause,Zap,Clock,TrendingUp,Award,Battery,Hash}from'lucide-react';import{toast}from'react-hot-toast';import{useQuery,useMutation,useQueryClient}from'react-query';import{miningAPI,energyAPI}from'../services/api';import{useTelegramWebApp}from'../hooks/useTelegramWebApp';import{useAuth}from'../hooks/useAuth';import MiningOrb from'../components/MiningOrb';import ProgressBar from'../components/ProgressBar';import StatCard from'../components/StatCard';import MiningHistory from'../components/MiningHistory';import'./MiningDashboard.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const MiningDashboard=()=>{const[miningProgress,setMiningProgress]=useState(0);const[timeRemaining,setTimeRemaining]=useState(0);const{hapticFeedback}=useTelegramWebApp();const{user}=useAuth();const queryClient=useQueryClient();// Fetch mining status\nconst{data:miningStatus,isLoading:statusLoading}=useQuery('miningStatus',miningAPI.getStatus,{refetchInterval:1000,// Update every second\nselect:response=>response.data});// Fetch energy status\nconst{data:energyStatus}=useQuery('energyStatus',energyAPI.getStatus,{refetchInterval:5000,// Update every 5 seconds\nselect:response=>response.data});// Fetch mining history\nconst{data:miningHistory}=useQuery('miningHistory',()=>miningAPI.getHistory({limit:10}),{refetchInterval:30000,// Update every 30 seconds\nselect:response=>response.data});// Start mining mutation\nconst startMiningMutation=useMutation(miningAPI.startMining,{onSuccess:()=>{hapticFeedback('impact','medium');toast.success('Mining started!');queryClient.invalidateQueries('miningStatus');queryClient.invalidateQueries('energyStatus');},onError:error=>{var _error$response,_error$response$data;hapticFeedback('notification','error');toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Failed to start mining');}});// Stop mining mutation\nconst stopMiningMutation=useMutation(miningAPI.stopMining,{onSuccess:()=>{hapticFeedback('impact','light');toast.success('Mining stopped');queryClient.invalidateQueries('miningStatus');},onError:error=>{var _error$response2,_error$response2$data;hapticFeedback('notification','error');toast.error(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Failed to stop mining');}});// Update mining progress\nuseEffect(()=>{if(miningStatus!==null&&miningStatus!==void 0&&miningStatus.isActive&&miningStatus!==null&&miningStatus!==void 0&&miningStatus.blockStartTime){const updateProgress=()=>{const now=Date.now();const startTime=new Date(miningStatus.blockStartTime).getTime();const blockDuration=3*60*1000;// 3 minutes in milliseconds\nconst elapsed=now-startTime;const progress=Math.min(elapsed/blockDuration*100,100);const remaining=Math.max(blockDuration-elapsed,0);setMiningProgress(progress);setTimeRemaining(remaining);// Auto-refresh when block completes\nif(progress>=100){queryClient.invalidateQueries('miningStatus');queryClient.invalidateQueries('miningHistory');}};updateProgress();const interval=setInterval(updateProgress,1000);return()=>clearInterval(interval);}else{setMiningProgress(0);setTimeRemaining(0);}},[miningStatus,queryClient]);const handleMiningToggle=()=>{if(miningStatus!==null&&miningStatus!==void 0&&miningStatus.isActive){stopMiningMutation.mutate();}else{if((energyStatus===null||energyStatus===void 0?void 0:energyStatus.current)<33){toast.error('Insufficient energy! Need at least 33 energy to mine.');return;}startMiningMutation.mutate();}};const formatTime=milliseconds=>{const minutes=Math.floor(milliseconds/60000);const seconds=Math.floor(milliseconds%60000/1000);return\"\".concat(minutes.toString().padStart(2,'0'),\":\").concat(seconds.toString().padStart(2,'0'));};const formatHashrate=hashrate=>{if(hashrate>=1000000){return\"\".concat((hashrate/1000000).toFixed(1),\"MH/s\");}else if(hashrate>=1000){return\"\".concat((hashrate/1000).toFixed(1),\"KH/s\");}return\"\".concat(hashrate,\"H/s\");};if(statusLoading){return/*#__PURE__*/_jsxs(\"div\",{className:\"mining-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading mining status...\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"mining-dashboard\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"dashboard-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-stats\",children:[/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(Hash,{size:16}),label:\"Hashrate\",value:formatHashrate((miningStatus===null||miningStatus===void 0?void 0:miningStatus.hashrate)||100),color:\"#1E90FF\"}),/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(Battery,{size:16}),label:\"Energy\",value:\"\".concat((energyStatus===null||energyStatus===void 0?void 0:energyStatus.current)||0,\"/\").concat((energyStatus===null||energyStatus===void 0?void 0:energyStatus.max)||1000),color:\"#10B981\",progress:((energyStatus===null||energyStatus===void 0?void 0:energyStatus.current)||0)/((energyStatus===null||energyStatus===void 0?void 0:energyStatus.max)||1000)*100}),/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(Award,{size:16}),label:\"AEGT\",value:user!==null&&user!==void 0&&user.aegtBalance?(user.aegtBalance/1e9).toFixed(2):'0.00',color:\"#FFD700\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"mining-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mining-container\",children:[/*#__PURE__*/_jsx(MiningOrb,{isActive:miningStatus===null||miningStatus===void 0?void 0:miningStatus.isActive,progress:miningProgress,level:(miningStatus===null||miningStatus===void 0?void 0:miningStatus.minerLevel)||1}),/*#__PURE__*/_jsx(\"div\",{className:\"mining-status\",children:/*#__PURE__*/_jsx(AnimatePresence,{mode:\"wait\",children:miningStatus!==null&&miningStatus!==void 0&&miningStatus.isActive?/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:\"status-active\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Mining Block #\",miningStatus.currentBlock]}),/*#__PURE__*/_jsx(\"p\",{className:\"status-text\",children:miningProgress>=100?'Block Complete!':'Mining in progress...'}),timeRemaining>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"time-remaining\",children:[/*#__PURE__*/_jsx(Clock,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:formatTime(timeRemaining)})]})]},\"mining\"):/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:\"status-waiting\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Miner Ready\"}),/*#__PURE__*/_jsx(\"p\",{className:\"status-text\",children:\"Start mining to earn AEGT tokens\"})]},\"waiting\")})}),/*#__PURE__*/_jsx(\"div\",{className:\"progress-section\",children:/*#__PURE__*/_jsx(ProgressBar,{progress:miningProgress,label:miningStatus!==null&&miningStatus!==void 0&&miningStatus.isActive?\"Block Progress\":\"Ready to Mine\",showPercentage:miningStatus===null||miningStatus===void 0?void 0:miningStatus.isActive})}),/*#__PURE__*/_jsxs(motion.button,{className:\"mining-btn \".concat(miningStatus!==null&&miningStatus!==void 0&&miningStatus.isActive?'mining-btn-stop':'mining-btn-start'),onClick:handleMiningToggle,disabled:startMiningMutation.isLoading||stopMiningMutation.isLoading,whileTap:{scale:0.95},whileHover:{scale:1.02},children:[/*#__PURE__*/_jsx(\"div\",{className:\"btn-content\",children:miningStatus!==null&&miningStatus!==void 0&&miningStatus.isActive?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Pause,{size:20}),/*#__PURE__*/_jsx(\"span\",{children:\"Stop Mining\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Play,{size:20}),/*#__PURE__*/_jsx(\"span\",{children:\"Start Mining\"})]})}),(startMiningMutation.isLoading||stopMiningMutation.isLoading)&&/*#__PURE__*/_jsx(\"div\",{className:\"btn-loading\",children:/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner-small\"})})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"history-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Latest Mining Blocks\"}),/*#__PURE__*/_jsx(TrendingUp,{size:20})]}),/*#__PURE__*/_jsx(MiningHistory,{blocks:(miningHistory===null||miningHistory===void 0?void 0:miningHistory.blocks)||[]})]}),/*#__PURE__*/_jsx(AnimatePresence,{children:(energyStatus===null||energyStatus===void 0?void 0:energyStatus.current)<100&&/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:\"energy-warning\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"warning-content\",children:[/*#__PURE__*/_jsx(Zap,{size:20}),/*#__PURE__*/_jsxs(\"div\",{className:\"warning-text\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Low Energy\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Your energy is running low. Consider upgrading or refilling.\"})]})]})})})]});};export default MiningDashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}